<nav id="legacy-top-navbar" class="navbar navbar-expand-lg navbar-light p-0">
    <div class="side-menu-bt-sidebar">
        <svg xmlns="http://www.w3.org/2000/svg" class="text-secondary wrapper-menu" width="30" fill="none" viewbox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </div>
    <div class="d-flex align-items-center">
        <div class="change-mode">
            <div class="custom-control custom-switch custom-switch-icon custom-control-inline">
                <div class="custom-switch-inner">
                    <p class="mb-0"></p>
                    <input type="checkbox" class="custom-control-input" id="dark-mode" data-active="true">
                     original dark-mode toggle markup kept but commented out
                </div>
            </div>
        </div>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-label="Toggle navigation">
            <svg xmlns="http://www.w3.org/2000/svg" class="text-secondary" width="30" fill="none" viewbox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
            </svg>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto navbar-list align-items-center">
                <li class="nav-item nav-icon dropdown">
                    <a href="#" class="nav-item nav-icon dropdown-toggle pr-0 search-toggle d-flex align-items-center" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        {% if avatar_url %}
                            <img src="/static/{{ avatar_url }}" class="img-fluid avatar-40 rounded-circle" alt="user">
                        {% else %}
                            <div class="avatar-40 rounded-circle bg-soft-primary d-flex align-items-center justify-content-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
                                    <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                                </svg>
                            </div>
                        {% endif %}
                        <span class="mb-0 ml-2 user-name">{{ nickname }}</span>
                        {% if user_role %}
                            <span class="badge ml-2
                                {% if user_role == 'super_admin' %} badge-danger
                                {% elif user_role == 'admin' %} badge-primary
                                {% else %} badge-success
                                {% endif %}" style="font-size: 0.75rem; padding: 0.3em 0.6em; font-weight: 500;">
                                {% if user_role == 'super_admin' %}超级管理员
                                {% elif user_role == 'admin' %}管理员
                                {% else %}普通用户
                                {% endif %}
                            </span>
                        {% endif %}
                    </a>
                    <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                        <li class="dropdown-item d-flex svg-icon">
                            <svg class="svg-icon mr-0 text-secondary" id="h-01-p" width="20" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            <a href="/user/profile">个人中心</a>
                        </li>
                        <li class="dropdown-divider"></li>
                        <li class="dropdown-item d-flex svg-icon">
                            <svg class="svg-icon mr-0 text-secondary" id="h-05-p" width="20" xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                            </svg>
                            <a href="/user/logout">退出登录</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>
<script>
(function(){
    try {
        document.addEventListener('DOMContentLoaded', function() {
            const links = document.querySelectorAll('a[href="/user/logout"]');
            links.forEach(function(a){
                if (a.__legacyLogoutBound) { return; }
                a.addEventListener('click', function(){
                    try {
                        localStorage.removeItem('weibo_cookie');
                        localStorage.removeItem('weibo_xsrf_token');
                    } catch (e) {}
                }, { once: true });
                a.__legacyLogoutBound = true;
            });
        });
    } catch (e) {}
})();
</script>
